[Unit]
Description=Nginx
After=docker.service,haveged.service,searchbroker.service,searchbroker-ui.service,mdr.service,mdr-ui.service,auth.service
Requires=docker.service,searchbroker.service,searchbroker-ui.service,mdr.service,mdr-ui.service,auth.service

[Service]
ExecStartPre=-/usr/bin/docker network create gba
ExecStartPre=/usr/bin/docker volume create acme-challenge
ExecStartPre=-/usr/bin/docker kill nginx
ExecStartPre=-/usr/bin/docker rm nginx
ExecStartPre=/usr/bin/docker pull nginx:${version}
ExecStart=/usr/bin/docker run \
    --name=nginx \
    --network=gba \
    -v /etc/nginx/conf.d:/etc/nginx/conf.d:ro \
    -v /etc/nginx/ssl:/etc/nginx/ssl:ro \
    -v acme-challenge:/certbot/.well-known/acme-challenge \
    -p 443:443 -p 80:80 \
nginx:${version}

ExecStop=/usr/bin/docker stop nginx

[Install]
WantedBy=multi-user.target
